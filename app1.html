import { useState, useEffect } from 'react';
import {
  Activity,
  Calendar,
  Pill,
  Brain,
  MessageSquare,
  Clipboard,
  User,
  Stethoscope,
  ChevronRight,
  PlusCircle,
  CircleCheck,
  CircleDashed,
  Loader2,
  AlertCircle,
  BarChart,
  Target,
  Gauge,
  LayoutDashboard,
  Bell,
  BookOpen,
  Trash2,
  X,
  Edit,
  Phone
} from 'lucide-react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

// --- Mock Data and Simulated API Calls ---

const initialPatientData = {
  id: 'patient-12345',
  name: 'Jane Doe',
  condition: 'Multiple Sclerosis (MS)',
  nextAppointment: '2025-09-02',
  nextAppointmentDetails: {
    doctor: 'Dr. Emily Carter',
    address: '123 Health Ave, Wellness City, CA 90210',
    time: '10:00 AM',
    mapLink: 'https://www.google.com/maps/place/123+Health+Ave',
  },
  symptomLog: [
    { date: '2025-08-10', symptom: 'Fatigue', severity: 4, notes: 'Felt very tired in the afternoon, had to rest.' },
    { date: '2025-08-11', symptom: 'Fatigue', severity: 3, notes: 'Managed to work, but felt drained.' },
    { date: '2025-08-12', symptom: 'Vision Changes', severity: 2, notes: 'Slight blurriness in the left eye for a few minutes.' },
    { date: '2025-08-13', symptom: 'Mobility Issues', severity: 5, notes: 'Had difficulty walking, needed a cane for support.' },
    { date: '2025-08-14', symptom: 'Fatigue', severity: 2, notes: 'Feeling better today, only minor fatigue.' },
  ],
  medication: [
    { id: 1, name: 'Gilenya (Fingolimod)', dose: '0.5mg', frequency: 'Daily', lastTaken: '2025-08-14' },
    { id: 2, name: 'Ampyra (Dalfampridine)', dose: '10mg', frequency: 'Twice daily', lastTaken: '2025-08-14' },
  ],
};

// Updated with working links
const mockEducationalResources = [
  { id: 1, title: 'Understanding MS: A Beginner\'s Guide', link: 'https://www.nationalmssociety.org/What-is-MS/Definition-of-MS' },
  { id: 2, title: 'Managing Fatigue with MS', link: 'https://www.healthline.com/health/multiple-sclerosis/managing-ms-fatigue' },
  { id: 3, title: 'Exercise and Physical Therapy for MS', link: 'https://www.ninds.nih.gov/health-information/patient-caregiver-education/fact-sheets/physical-therapy-and-rehabilitation-multiple-sclerosis' },
  { id: 4, title: 'Tips for a Healthy Diet with MS', link: 'https://www.ms-society.ie/living-with-ms/exercise-and-wellbeing/healthy-eating-and-ms' },
];

const simulateFetchResources = () => {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(mockEducationalResources);
    }, 1500); // Simulate a 1.5-second API call
  });
};

const simulateAIAnalysis = (data) => {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve({
        summary: "Jane's recent symptom logs indicate a notable increase in mobility issues and fluctuating fatigue levels. The vision changes logged on August 12th are a new development that warrants attention. Overall medication adherence appears to be consistent. It's recommended to check in on the reported mobility issues and the new vision symptom during her upcoming appointment.",
        riskLevel: 'High',
        actionableInsights: [
          'Schedule a follow-up call to discuss the new vision symptom.',
          'Review the mobility issue with the physical therapist.',
          'Send a supportive message to Jane regarding her consistent medication adherence.',
        ],
      });
    }, 2000); // Simulate a 2-second API call
  });
};

// --- Main App Component ---

export default function App() {
  const [view, setView] = useState('patient-dashboard'); // 'patient-dashboard', 'patient-resources', 'doctor-dashboard'
  const [isAiLoading, setIsAiLoading] = useState(false);
  const [aiAnalysis, setAiAnalysis] = useState(null);
  const [educationalResources, setEducationalResources] = useState([]);
  const [isResourceLoading, setIsResourceLoading] = useState(false);
  const [showNotification, setShowNotification] = useState(false);
  const [notificationMessage, setNotificationMessage] = useState('');
  const [showAppointmentModal, setShowAppointmentModal] = useState(false);
  const [showMedicationModal, setShowMedicationModal] = useState(false);
  const [showSymptomModal, setShowSymptomModal] = useState(false); // New state for symptom modal
  const [medicationToEdit, setMedicationToEdit] = useState(null);
  const [medicationList, setMedicationList] = useState(initialPatientData.medication);
  const [patientData, setPatientData] = useState(initialPatientData);

  // Effect to fetch AI analysis when in doctor view
  useEffect(() => {
    if (view === 'doctor-dashboard' && !aiAnalysis) {
      setIsAiLoading(true);
      simulateAIAnalysis(patientData).then((analysis) => {
        setAiAnalysis(analysis);
        setIsAiLoading(false);
      });
    }
  }, [view, aiAnalysis, patientData]);

  // Effect to fetch educational resources when in patient resource view
  useEffect(() => {
    if (view === 'patient-resources' && educationalResources.length === 0) {
      setIsResourceLoading(true);
      simulateFetchResources().then((resources) => {
        setEducationalResources(resources);
        setIsResourceLoading(false);
      });
    }
  }, [view, educationalResources]);

  // Function to show a temporary notification
  const handleShowNotification = (message) => {
    setNotificationMessage(message);
    setShowNotification(true);
    setTimeout(() => {
      setShowNotification(false);
      setNotificationMessage('');
    }, 3000); // Notification disappears after 3 seconds
  };

  const handleAddMedication = (newMed) => {
    const newId = medicationList.length > 0 ? Math.max(...medicationList.map(m => m.id)) + 1 : 1;
    setMedicationList([...medicationList, { ...newMed, id: newId, lastTaken: 'N/A' }]);
    setShowMedicationModal(false);
    handleShowNotification('Medication added successfully!');
  };

  const handleEditMedication = (updatedMed) => {
    setMedicationList(medicationList.map(med => med.id === updatedMed.id ? updatedMed : med));
    setShowMedicationModal(false);
    handleShowNotification('Medication updated successfully!');
  };

  const handleRemoveMedication = (medId) => {
    setMedicationList(medicationList.filter(med => med.id !== medId));
    handleShowNotification('Medication removed!');
  };

  const handleLogMedicationTaken = (medId) => {
    setMedicationList(medicationList.map(med => {
      if (med.id === medId) {
        return { ...med, lastTaken: new Date().toISOString().split('T')[0] };
      }
      return med;
    }));
    handleShowNotification('Medication logged as taken!');
  };
  
  // New function to handle adding a new symptom
  const handleAddSymptom = (newSymptom) => {
    setPatientData(prevData => ({
      ...prevData,
      symptomLog: [...prevData.symptomLog, newSymptom].sort((a, b) => new Date(b.date) - new Date(a.date)) // Sort by date
    }));
    setShowSymptomModal(false);
    handleShowNotification('New symptom logged successfully!');
  };

  // --- Shared UI Components ---

  const Header = () => (
    <header className="bg-white shadow-md p-4 sticky top-0 z-50 rounded-b-3xl">
      <div className="container mx-auto flex justify-center items-center">
        <div className="flex items-center space-x-2">
          <Brain className="w-8 h-8 text-violet-600" />
          <h1 className="text-2xl font-bold text-gray-800 font-inter">NeurologyCare</h1>
        </div>
      </div>
    </header>
  );

  const DashboardCard = ({ title, icon, children }) => (
    <div className="bg-white rounded-3xl shadow-lg p-6 flex flex-col space-y-4 transition-all duration-300 hover:shadow-xl border border-gray-200">
      <div className="flex items-center space-x-3 text-violet-600">
        {icon}
        <h2 className="text-lg font-semibold text-gray-800 font-inter">{title}</h2>
      </div>
      {children}
    </div>
  );

  const BottomNav = () => (
    <nav className="fixed bottom-0 left-0 right-0 bg-white shadow-2xl rounded-t-3xl p-4 z-50">
      <div className="flex justify-around">
        <button
          onClick={() => setView('patient-dashboard')}
          className={`flex-1 flex flex-col items-center p-2 rounded-xl transition-colors duration-300 ${view.startsWith('patient') ? 'text-violet-600 bg-violet-50' : 'text-gray-500 hover:text-violet-600'}`}
        >
          <LayoutDashboard className="w-6 h-6" />
          <span className="text-xs mt-1 font-medium">Dashboard</span>
        </button>
        <button
          onClick={() => setView('patient-resources')}
          className={`flex-1 flex flex-col items-center p-2 rounded-xl transition-colors duration-300 ${view === 'patient-resources' ? 'text-violet-600 bg-violet-50' : 'text-gray-500 hover:text-violet-600'}`}
        >
          <BookOpen className="w-6 h-6" />
          <span className="text-xs mt-1 font-medium">Resources</span>
        </button>
        <button
          onClick={() => setView('doctor-dashboard')}
          className={`flex-1 flex flex-col items-center p-2 rounded-xl transition-colors duration-300 ${view === 'doctor-dashboard' ? 'text-violet-600 bg-violet-50' : 'text-gray-500 hover:text-violet-600'}`}
        >
          <Stethoscope className="w-6 h-6" />
          <span className="text-xs mt-1 font-medium">Doctor View</span>
        </button>
      </div>
    </nav>
  );

  const Notification = () => (
    <div className={`fixed bottom-24 left-1/2 -translate-x-1/2 p-4 rounded-xl shadow-lg transition-all duration-300 transform ${showNotification ? 'scale-100 opacity-100' : 'scale-90 opacity-0'} ${notificationMessage.includes('Error') ? 'bg-red-500' : 'bg-emerald-500'} text-white font-semibold z-50`}>
      <p>{notificationMessage}</p>
    </div>
  );

  const Modal = ({ title, children, onClose }) => (
    <div className="fixed inset-0 z-[100] bg-gray-900 bg-opacity-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-3xl shadow-xl w-full max-w-md p-6 relative">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-xl font-bold text-gray-800">{title}</h3>
          <button onClick={onClose} className="p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors">
            <X className="w-6 h-6" />
          </button>
        </div>
        {children}
      </div>
    </div>
  );
  
  const AppointmentDetailsModal = () => (
    <Modal title="Appointment Details" onClose={() => setShowAppointmentModal(false)}>
      <div className="space-y-4">
        <p className="flex items-center space-x-2 text-gray-700">
          <Stethoscope className="w-5 h-5 text-violet-500" />
          <span>Doctor: <span className="font-semibold">{patientData.nextAppointmentDetails.doctor}</span></span>
        </p>
        <p className="flex items-center space-x-2 text-gray-700">
          <Calendar className="w-5 h-5 text-violet-500" />
          <span>Date: <span className="font-semibold">{new Date(patientData.nextAppointment).toLocaleDateString()}</span></span>
        </p>
        <p className="flex items-center space-x-2 text-gray-700">
          <Bell className="w-5 h-5 text-violet-500" />
          <span>Time: <span className="font-semibold">{patientData.nextAppointmentDetails.time}</span></span>
        </p>
        <p className="flex items-center space-x-2 text-gray-700">
          <MessageSquare className="w-5 h-5 text-violet-500" />
          <span>Address: <span className="font-semibold">{patientData.nextAppointmentDetails.address}</span></span>
        </p>
        <a href={patientData.nextAppointmentDetails.mapLink} target="_blank" rel="noopener noreferrer" className="w-full inline-flex items-center justify-center gap-2 bg-indigo-500 text-white py-2 px-4 rounded-xl font-semibold hover:bg-indigo-600 transition-colors">
          <Clipboard className="w-5 h-5" />
          View on Map
        </a>
      </div>
    </Modal>
  );

  const MedicationFormModal = () => {
    const [name, setName] = useState(medicationToEdit?.name || '');
    const [dose, setDose] = useState(medicationToEdit?.dose || '');
    const [frequency, setFrequency] = useState(medicationToEdit?.frequency || '');

    const handleSubmit = (e) => {
      e.preventDefault();
      const newMed = { name, dose, frequency, lastTaken: medicationToEdit?.lastTaken || 'N/A' };
      if (medicationToEdit) {
        handleEditMedication({ ...newMed, id: medicationToEdit.id });
      } else {
        handleAddMedication(newMed);
      }
    };

    return (
      <Modal title={medicationToEdit ? 'Edit Medication' : 'Add Medication'} onClose={() => setShowMedicationModal(false)}>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700">Medication Name</label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              required
              className="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Dose</label>
            <input
              type="text"
              value={dose}
              onChange={(e) => setDose(e.target.value)}
              required
              className="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Frequency</label>
            <input
              type="text"
              value={frequency}
              onChange={(e) => setFrequency(e.target.value)}
              required
              className="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"
            />
          </div>
          <button type="submit" className="w-full bg-violet-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-violet-700 transition-colors">
            {medicationToEdit ? 'Save Changes' : 'Add Medication'}
          </button>
        </form>
      </Modal>
    );
  };
  
  const SymptomFormModal = () => {
    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
    const [symptom, setSymptom] = useState('');
    const [severity, setSeverity] = useState(1);
    const [notes, setNotes] = useState('');

    const handleSubmit = (e) => {
      e.preventDefault();
      const newSymptom = { date, symptom, severity: parseInt(severity), notes };
      handleAddSymptom(newSymptom);
    };

    return (
      <Modal title="Log New Symptom" onClose={() => setShowSymptomModal(false)}>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700">Date</label>
            <input
              type="date"
              value={date}
              onChange={(e) => setDate(e.target.value)}
              required
              className="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Symptom</label>
            <input
              type="text"
              value={symptom}
              onChange={(e) => setSymptom(e.target.value)}
              required
              className="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Severity (1-5)</label>
            <input
              type="number"
              min="1"
              max="5"
              value={severity}
              onChange={(e) => setSeverity(e.target.value)}
              required
              className="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Notes</label>
            <textarea
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              rows="3"
              className="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"
            />
          </div>
          <button type="submit" className="w-full bg-emerald-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-emerald-700 transition-colors">
            Log Symptom
          </button>
        </form>
      </Modal>
    );
  };
  
  // --- Patient View Components ---

  const PatientDashboard = () => (
    <div className="space-y-6">
      <div className="grid md:grid-cols-2 gap-6">
        {/* Next Appointment Card */}
        <DashboardCard
          title="Upcoming Appointment"
          icon={<Calendar className="w-6 h-6" />}
        >
          <div className="flex items-center space-x-4">
            <div className="w-12 h-12 bg-violet-600 text-white rounded-full flex items-center justify-center font-bold text-lg">
              {new Date(patientData.nextAppointment).getDate()}
            </div>
            <div>
              <p className="text-sm text-gray-500">Scheduled for</p>
              <p className="text-lg font-semibold text-gray-900">{new Date(patientData.nextAppointment).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}</p>
            </div>
          </div>
          <button
            onClick={() => setShowAppointmentModal(true)}
            className="w-full bg-gradient-to-r from-violet-500 to-indigo-600 text-white py-3 px-6 rounded-xl font-semibold shadow-md hover:from-violet-600 hover:to-indigo-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
          >
            View Details
          </button>
        </DashboardCard>

        {/* Medication Adherence Card */}
        <DashboardCard
          title="Medication Adherence"
          icon={<Pill className="w-6 h-6" />}
        >
          <ul className="space-y-3">
            {medicationList.map((med, index) => (
              <li key={med.id} className="flex flex-col md:flex-row items-start md:items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200">
                <div className="flex items-center space-x-3 w-full md:w-auto">
                  <div className="flex-shrink-0">
                    {med.lastTaken === new Date().toISOString().split('T')[0] ?
                      <CircleCheck className="text-emerald-500 w-5 h-5" /> :
                      <CircleDashed className="text-gray-400 w-5 h-5" />
                    }
                  </div>
                  <div>
                    <p className="font-medium text-gray-900">{med.name}</p>
                    <p className="text-sm text-gray-500">{med.dose} - {med.frequency}</p>
                  </div>
                </div>
                <div className="mt-2 md:mt-0 flex flex-wrap gap-2 justify-end">
                  <span className="text-sm text-gray-500 self-center">Last taken: {med.lastTaken}</span>
                  <button onClick={() => handleLogMedicationTaken(med.id)} className="p-2 text-sm bg-emerald-500 text-white rounded-lg hover:bg-emerald-600">
                    Log Taken
                  </button>
                  <button onClick={() => { setMedicationToEdit(med); setShowMedicationModal(true); }} className="p-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                    <Edit className="w-4 h-4" />
                  </button>
                  <button onClick={() => handleRemoveMedication(med.id)} className="p-2 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600">
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>
              </li>
            ))}
          </ul>
          <button
            onClick={() => { setMedicationToEdit(null); setShowMedicationModal(true); }}
            className="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white py-3 px-6 rounded-xl font-semibold shadow-md hover:from-emerald-600 hover:to-green-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
          >
            <span className="flex items-center justify-center gap-2">
              <PlusCircle className="w-5 h-5" />
              Add New Medication
            </span>
          </button>
        </DashboardCard>
      </div>

      {/* Symptom Log Card */}
      <DashboardCard
        title="My Symptom Log"
        icon={<Activity className="w-6 h-6" />}
      >
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symptom</th>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Severity (1-5)</th>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {patientData.symptomLog.map((log, index) => (
                <tr key={index}>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{log.date}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{log.symptom}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{log.severity}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{log.notes}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <button
          onClick={() => setShowSymptomModal(true)}
          className="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white py-3 px-6 rounded-xl font-semibold shadow-md hover:from-emerald-600 hover:to-green-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
        >
          <span className="flex items-center justify-center gap-2">
            <PlusCircle className="w-5 h-5" />
            Log New Symptom
          </span>
        </button>
      </DashboardCard>
    </div>
  );
  
  const PatientResources = () => (
    <div className="space-y-6">
      <DashboardCard
        title="Educational Resources"
        icon={<BookOpen className="w-6 h-6" />}
      >
        {isResourceLoading ? (
          <div className="flex flex-col items-center justify-center py-8">
            <Loader2 className="w-10 h-10 text-violet-500 animate-spin" />
            <p className="mt-4 text-gray-600">Fetching resources...</p>
          </div>
        ) : (
          <ul className="space-y-2">
            {educationalResources.map((resource, index) => (
              <li key={index} className="flex items-center justify-between p-3 bg-violet-50 rounded-xl">
                <a href={resource.link} target="_blank" rel="noopener noreferrer" className="flex items-center space-x-2 text-violet-700 hover:text-violet-900 transition-colors">
                  <ChevronRight className="w-4 h-4" />
                  <span className="font-medium">{resource.title}</span>
                </a>
              </li>
            ))}
          </ul>
        )}
      </DashboardCard>
    </div>
  );

  // --- Doctor View Components ---

  const DoctorDashboard = () => (
    <div className="space-y-6">
      {/* Patient Header */}
      <div className="bg-gradient-to-r from-violet-600 to-indigo-700 text-white rounded-3xl shadow-lg p-6 flex flex-col md:flex-row justify-between items-center">
        <div className="flex items-center space-x-4">
          <User className="w-12 h-12 text-violet-200 bg-violet-800 p-2 rounded-full" />
          <div>
            <h2 className="text-2xl font-bold font-inter">Patient: {patientData.name}</h2>
            <p className="text-violet-200">{patientData.condition}</p>
          </div>
        </div>
        <div className="mt-4 md:mt-0 flex flex-col space-y-2 text-sm text-violet-200">
          <p>Next Appointment: {patientData.nextAppointment}</p>
          <p>Patient ID: {patientData.id}</p>
        </div>
      </div>

      {/* AI-Powered Analysis */}
      <DashboardCard
        title="AI-Powered Patient Insights"
        icon={<Brain className="w-6 h-6" />}
      >
        {isAiLoading ? (
          <div className="flex flex-col items-center justify-center py-8">
            <Loader2 className="w-10 h-10 text-violet-500 animate-spin" />
            <p className="mt-4 text-gray-600">Analyzing patient data...</p>
          </div>
        ) : aiAnalysis ? (
          <>
            <div className={`p-4 rounded-xl border-l-4 ${aiAnalysis.riskLevel === 'High' ? 'border-red-500 bg-red-50' : 'border-green-500 bg-green-50'}`}>
              <div className="flex items-center gap-2 text-sm font-semibold text-gray-800">
                <AlertCircle className="w-5 h-5 text-red-500" />
                Risk Level: <span className={`${aiAnalysis.riskLevel === 'High' ? 'text-red-600' : 'text-green-600'}`}>{aiAnalysis.riskLevel}</span>
              </div>
              <p className="text-gray-600 mt-2 text-sm">{aiAnalysis.summary}</p>
            </div>
            
            <div className="space-y-4">
              <h3 className="font-semibold text-gray-800">Key Symptom Trends</h3>
              <div className="bg-gray-50 rounded-xl p-4">
                <ResponsiveContainer width="100%" height={200}>
                  <LineChart data={patientData.symptomLog}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                    <XAxis dataKey="date" />
                    <YAxis domain={[0, 5]} />
                    <Tooltip />
                    <Line type="monotone" dataKey="severity" stroke="#8b5cf6" activeDot={{ r: 8 }} />
                  </LineChart>
                </ResponsiveContainer>
                <p className="text-center text-sm text-gray-500 mt-2">Symptom Severity (1-5) over time</p>
              </div>

              <h3 className="font-semibold text-gray-800 mt-4">Actionable Insights</h3>
              <ul className="space-y-2">
                {aiAnalysis.actionableInsights.map((insight, index) => (
                  <li key={index} className="flex items-start space-x-2">
                    {insight.includes('call') ? (
                      <Phone className="w-5 h-5 text-violet-500 flex-shrink-0 mt-1" />
                    ) : (
                      <Target className="w-5 h-5 text-violet-500 flex-shrink-0 mt-1" />
                    )}
                    <span className="text-gray-700">{insight}</span>
                  </li>
                ))}
              </ul>
            </div>
          </>
        ) : (
          <p className="text-gray-500 text-center">Loading AI insights...</p>
        )}
      </DashboardCard>
    </div>
  );

  return (
    <div className="bg-gray-100 min-h-screen font-sans antialiased text-gray-800 pb-20">
      <Header />
      <main className="container mx-auto p-4 md:p-8">
        {view === 'patient-dashboard' && <PatientDashboard />}
        {view === 'patient-resources' && <PatientResources />}
        {view === 'doctor-dashboard' && <DoctorDashboard />}
      </main>
      <Notification />
      <BottomNav />
      {showAppointmentModal && <AppointmentDetailsModal />}
      {showMedicationModal && <MedicationFormModal />}
      {showSymptomModal && <SymptomFormModal />}
    </div>
  );
}
