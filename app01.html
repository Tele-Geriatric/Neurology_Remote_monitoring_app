<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeurologyCare</title>
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/lucide.js"></script>
    <!-- Recharts Library for the chart -->
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen font-sans antialiased text-gray-800 pb-20">

    <!-- Header -->
    <header class="bg-white shadow-md p-4 sticky top-0 z-50 rounded-b-3xl">
        <div class="container mx-auto flex justify-center items-center">
            <div class="flex items-center space-x-2">
                <span data-lucide="brain" class="w-8 h-8 text-violet-600"></span>
                <h1 class="text-2xl font-bold text-gray-800">NeurologyCare</h1>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main id="app-content" class="container mx-auto p-4 md:p-8 space-y-6">
        <!-- Content will be rendered here dynamically -->
    </main>

    <!-- Notification -->
    <div id="notification-container" class="fixed bottom-24 left-1/2 -translate-x-1/2 p-4 rounded-xl shadow-lg transition-all duration-300 transform scale-90 opacity-0 text-white font-semibold z-50"></div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-2xl rounded-t-3xl p-4 z-50">
        <div class="flex justify-around">
            <button id="nav-dashboard" class="flex-1 flex flex-col items-center p-2 rounded-xl transition-colors duration-300 text-violet-600 bg-violet-50">
                <span data-lucide="layout-dashboard" class="w-6 h-6"></span>
                <span class="text-xs mt-1 font-medium">Dashboard</span>
            </button>
            <button id="nav-resources" class="flex-1 flex flex-col items-center p-2 rounded-xl transition-colors duration-300 text-gray-500 hover:text-violet-600">
                <span data-lucide="book-open" class="w-6 h-6"></span>
                <span class="text-xs mt-1 font-medium">Resources</span>
            </button>
            <button id="nav-doctor" class="flex-1 flex flex-col items-center p-2 rounded-xl transition-colors duration-300 text-gray-500 hover:text-violet-600">
                <span data-lucide="stethoscope" class="w-6 h-6"></span>
                <span class="text-xs mt-1 font-medium">Doctor View</span>
            </button>
        </div>
    </nav>

    <!-- Modals -->
    <!-- Appointment Details Modal -->
    <div id="appointment-modal" class="fixed inset-0 z-[100] bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-xl w-full max-w-md p-6 relative">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Appointment Details</h3>
                <button onclick="hideModal('appointment-modal')" class="p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors">
                    <span data-lucide="x" class="w-6 h-6"></span>
                </button>
            </div>
            <div id="appointment-modal-content" class="space-y-4"></div>
        </div>
    </div>
    
    <!-- Symptom Log Modal -->
    <div id="symptom-modal" class="fixed inset-0 z-[100] bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-xl w-full max-w-md p-6 relative">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Log New Symptom</h3>
                <button onclick="hideModal('symptom-modal')" class="p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors">
                    <span data-lucide="x" class="w-6 h-6"></span>
                </button>
            </div>
            <form id="symptom-form" class="space-y-4"></form>
        </div>
    </div>
    
    <!-- Medication Form Modal -->
    <div id="medication-modal" class="fixed inset-0 z-[100] bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-xl w-full max-w-md p-6 relative">
            <div class="flex justify-between items-center mb-4">
                <h3 id="medication-modal-title" class="text-xl font-bold text-gray-800">Add Medication</h3>
                <button onclick="hideModal('medication-modal')" class="p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors">
                    <span data-lucide="x" class="w-6 h-6"></span>
                </button>
            </div>
            <form id="medication-form" class="space-y-4"></form>
        </div>
    </div>

    <script>
        // --- Global State ---
        let currentView = 'patient-dashboard';
        let medicationList = [];
        let patientData = {
            id: 'patient-12345',
            name: 'Jane Doe',
            condition: 'Multiple Sclerosis (MS)',
            nextAppointment: '2025-09-02',
            nextAppointmentDetails: {
                doctor: 'Dr. Emily Carter',
                address: '123 Health Ave, Wellness City, CA 90210',
                time: '10:00 AM',
                mapLink: 'https://www.google.com/maps/place/123+Health+Ave',
            },
            symptomLog: [
                { date: '2025-08-10', symptom: 'Fatigue', severity: 4, notes: 'Felt very tired in the afternoon, had to rest.' },
                { date: '2025-08-11', symptom: 'Fatigue', severity: 3, notes: 'Managed to work, but felt drained.' },
                { date: '2025-08-12', symptom: 'Vision Changes', severity: 2, notes: 'Slight blurriness in the left eye for a few minutes.' },
                { date: '2025-08-13', symptom: 'Mobility Issues', severity: 5, notes: 'Had difficulty walking, needed a cane for support.' },
                { date: '2025-08-14', symptom: 'Fatigue', severity: 2, notes: 'Feeling better today, only minor fatigue.' },
            ],
            medication: [
                { id: 1, name: 'Gilenya (Fingolimod)', dose: '0.5mg', frequency: 'Daily', lastTaken: '2025-08-14' },
                { id: 2, name: 'Ampyra (Dalfampridine)', dose: '10mg', frequency: 'Twice daily', lastTaken: '2025-08-14' },
            ],
        };

        const mockEducationalResources = [
            { id: 1, title: 'Understanding MS: A Beginner\'s Guide', link: 'https://www.nationalmssociety.org/What-is-MS/Definition-of-MS' },
            { id: 2, title: 'Managing Fatigue with MS', link: 'https://www.healthline.com/health/multiple-sclerosis/managing-ms-fatigue' },
            { id: 3, title: 'Exercise and Physical Therapy for MS', link: 'https://www.ninds.nih.gov/health-information/patient-caregiver-education/fact-sheets/physical-therapy-and-rehabilitation-multiple-sclerosis' },
            { id: 4, title: 'Tips for a Healthy Diet with MS', link: 'https://www.ms-society.ie/living-with-ms/exercise-and-wellbeing/healthy-eating-and-ms' },
        ];

        // --- Helper Functions ---
        const showModal = (modalId) => {
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        };

        const hideModal = (modalId) => {
            document.getElementById(modalId).classList.remove('flex');
            document.getElementById(modalId).classList.add('hidden');
        };

        const showNotification = (message, isError = false) => {
            const container = document.getElementById('notification-container');
            container.textContent = message;
            container.classList.remove('scale-90', 'opacity-0', 'bg-red-500', 'bg-emerald-500');
            container.classList.add('scale-100', 'opacity-100');
            container.classList.add(isError ? 'bg-red-500' : 'bg-emerald-500');

            setTimeout(() => {
                container.classList.remove('scale-100', 'opacity-100');
                container.classList.add('scale-90', 'opacity-0');
            }, 3000);
        };

        // --- Data Fetching Simulation ---
        const simulateFetchResources = () => {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(mockEducationalResources);
                }, 1500);
            });
        };

        const simulateAIAnalysis = (data) => {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({
                        summary: "Jane's recent symptom logs indicate a notable increase in mobility issues and fluctuating fatigue levels. The vision changes logged on August 12th are a new development that warrants attention. Overall medication adherence appears to be consistent. It's recommended to check in on the reported mobility issues and the new vision symptom during her upcoming appointment.",
                        riskLevel: 'High',
                        actionableInsights: [
                            'Schedule a follow-up call to discuss the new vision symptom.',
                            'Review the mobility issue with the physical therapist.',
                            'Send a supportive message to Jane regarding her consistent medication adherence.',
                        ],
                    });
                }, 2000);
            });
        };
        
        // --- Rendering Functions ---

        const renderAppContent = () => {
            const contentDiv = document.getElementById('app-content');
            contentDiv.innerHTML = ''; // Clear previous content

            switch (currentView) {
                case 'patient-dashboard':
                    renderPatientDashboard(contentDiv);
                    break;
                case 'patient-resources':
                    renderPatientResources(contentDiv);
                    break;
                case 'doctor-dashboard':
                    renderDoctorDashboard(contentDiv);
                    break;
            }

            // Re-render Lucide icons after DOM manipulation
            if (lucide) {
                lucide.createIcons();
            }
        };

        const renderPatientDashboard = (container) => {
            container.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Next Appointment Card -->
                    <div class="bg-white rounded-3xl shadow-lg p-6 flex flex-col space-y-4 transition-all duration-300 hover:shadow-xl border border-gray-200">
                        <div class="flex items-center space-x-3 text-violet-600">
                            <span data-lucide="calendar" class="w-6 h-6"></span>
                            <h2 class="text-lg font-semibold text-gray-800">Upcoming Appointment</h2>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-violet-600 text-white rounded-full flex items-center justify-center font-bold text-lg">
                                ${new Date(patientData.nextAppointment).getDate()}
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Scheduled for</p>
                                <p class="text-lg font-semibold text-gray-900">${new Date(patientData.nextAppointment).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}</p>
                            </div>
                        </div>
                        <button id="view-appointment-btn" class="w-full bg-gradient-to-r from-violet-500 to-indigo-600 text-white py-3 px-6 rounded-xl font-semibold shadow-md hover:from-violet-600 hover:to-indigo-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            View Details
                        </button>
                    </div>

                    <!-- Medication Adherence Card -->
                    <div class="bg-white rounded-3xl shadow-lg p-6 flex flex-col space-y-4 transition-all duration-300 hover:shadow-xl border border-gray-200">
                        <div class="flex items-center space-x-3 text-violet-600">
                            <span data-lucide="pill" class="w-6 h-6"></span>
                            <h2 class="text-lg font-semibold text-gray-800">Medication Adherence</h2>
                        </div>
                        <ul id="medication-list" class="space-y-3"></ul>
                        <button id="add-medication-btn" class="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white py-3 px-6 rounded-xl font-semibold shadow-md hover:from-emerald-600 hover:to-green-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
                            <span class="flex items-center justify-center gap-2">
                                <span data-lucide="plus-circle" class="w-5 h-5"></span>
                                Add New Medication
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Symptom Log Card -->
                <div class="bg-white rounded-3xl shadow-lg p-6 flex flex-col space-y-4 transition-all duration-300 hover:shadow-xl border border-gray-200">
                    <div class="flex items-center space-x-3 text-violet-600">
                        <span data-lucide="activity" class="w-6 h-6"></span>
                        <h2 class="text-lg font-semibold text-gray-800">My Symptom Log</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symptom</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Severity (1-5)</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="symptom-log-table-body" class="bg-white divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                    <button id="log-symptom-btn" class="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white py-3 px-6 rounded-xl font-semibold shadow-md hover:from-emerald-600 hover:to-green-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
                        <span class="flex items-center justify-center gap-2">
                            <span data-lucide="plus-circle" class="w-5 h-5"></span>
                            Log New Symptom
                        </span>
                    </button>
                </div>
            `;

            renderSymptomLogTable();
            renderMedicationList();
            setupPatientDashboardListeners();
        };

        const renderPatientResources = (container) => {
            container.innerHTML = `
                <div class="bg-white rounded-3xl shadow-lg p-6 flex flex-col space-y-4 transition-all duration-300 hover:shadow-xl border border-gray-200">
                    <div class="flex items-center space-x-3 text-violet-600">
                        <span data-lucide="book-open" class="w-6 h-6"></span>
                        <h2 class="text-lg font-semibold text-gray-800">Educational Resources</h2>
                    </div>
                    <div id="resources-loading-container" class="flex flex-col items-center justify-center py-8">
                        <span data-lucide="loader-2" class="w-10 h-10 text-violet-500 animate-spin"></span>
                        <p class="mt-4 text-gray-600">Fetching resources...</p>
                    </div>
                    <ul id="resources-list" class="space-y-2 hidden"></ul>
                </div>
            `;
            
            // Simulate API call and render resources
            simulateFetchResources().then(resources => {
                const loadingContainer = document.getElementById('resources-loading-container');
                const list = document.getElementById('resources-list');
                loadingContainer.classList.add('hidden');
                list.classList.remove('hidden');

                list.innerHTML = resources.map(resource => `
                    <li class="flex items-center justify-between p-3 bg-violet-50 rounded-xl">
                        <a href="${resource.link}" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-2 text-violet-700 hover:text-violet-900 transition-colors">
                            <span data-lucide="chevron-right" class="w-4 h-4"></span>
                            <span class="font-medium">${resource.title}</span>
                        </a>
                    </li>
                `).join('');
                if (lucide) {
                    lucide.createIcons();
                }
            });
        };

        const renderDoctorDashboard = (container) => {
            container.innerHTML = `
                <!-- Patient Header -->
                <div class="bg-gradient-to-r from-violet-600 to-indigo-700 text-white rounded-3xl shadow-lg p-6 flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <span data-lucide="user" class="w-12 h-12 text-violet-200 bg-violet-800 p-2 rounded-full"></span>
                        <div>
                            <h2 class="text-2xl font-bold">Patient: ${patientData.name}</h2>
                            <p class="text-violet-200">${patientData.condition}</p>
                        </div>
                    </div>
                    <div class="mt-4 md:mt-0 flex flex-col space-y-2 text-sm text-violet-200">
                        <p>Next Appointment: ${patientData.nextAppointment}</p>
                        <p>Patient ID: ${patientData.id}</p>
                    </div>
                </div>

                <!-- AI-Powered Analysis -->
                <div class="bg-white rounded-3xl shadow-lg p-6 flex flex-col space-y-4 transition-all duration-300 hover:shadow-xl border border-gray-200">
                    <div class="flex items-center space-x-3 text-violet-600">
                        <span data-lucide="brain" class="w-6 h-6"></span>
                        <h2 class="text-lg font-semibold text-gray-800">AI-Powered Patient Insights</h2>
                    </div>
                    <div id="ai-loading-container" class="flex flex-col items-center justify-center py-8">
                        <span data-lucide="loader-2" class="w-10 h-10 text-violet-500 animate-spin"></span>
                        <p class="mt-4 text-gray-600">Analyzing patient data...</p>
                    </div>
                    <div id="ai-analysis-content" class="hidden"></div>
                </div>
            `;
            
            // Simulate API call and render analysis
            simulateAIAnalysis(patientData).then(analysis => {
                const loadingContainer = document.getElementById('ai-loading-container');
                const analysisContent = document.getElementById('ai-analysis-content');
                loadingContainer.classList.add('hidden');
                analysisContent.classList.remove('hidden');

                const riskColor = analysis.riskLevel === 'High' ? 'border-red-500 bg-red-50' : 'border-green-500 bg-green-50';
                const riskTextColor = analysis.riskLevel === 'High' ? 'text-red-600' : 'text-green-600';

                analysisContent.innerHTML = `
                    <div class="p-4 rounded-xl border-l-4 ${riskColor}">
                        <div class="flex items-center gap-2 text-sm font-semibold text-gray-800">
                            <span data-lucide="alert-circle" class="w-5 h-5 text-red-500"></span>
                            Risk Level: <span class="${riskTextColor}">${analysis.riskLevel}</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">${analysis.summary}</p>
                    </div>
                    
                    <div class="space-y-4">
                        <h3 class="font-semibold text-gray-800">Key Symptom Trends</h3>
                        <div id="symptom-chart-container" class="bg-gray-50 rounded-xl p-4"></div>
                        <h3 class="font-semibold text-gray-800 mt-4">Actionable Insights</h3>
                        <ul class="space-y-2">
                            ${analysis.actionableInsights.map(insight => `
                                <li class="flex items-start space-x-2">
                                    <span data-lucide="${insight.includes('call') ? 'phone' : 'target'}" class="w-5 h-5 text-violet-500 flex-shrink-0 mt-1"></span>
                                    <span class="text-gray-700">${insight}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
                if (lucide) {
                    lucide.createIcons();
                }
                renderSymptomChart();
            });
        };

        const renderSymptomLogTable = () => {
            const tableBody = document.getElementById('symptom-log-table-body');
            tableBody.innerHTML = patientData.symptomLog.map(log => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${log.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${log.symptom}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${log.severity}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${log.notes}</td>
                </tr>
            `).join('');
        };

        const renderMedicationList = () => {
            const list = document.getElementById('medication-list');
            list.innerHTML = patientData.medication.map(med => `
                <li class="flex flex-col md:flex-row items-start md:items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200">
                    <div class="flex items-center space-x-3 w-full md:w-auto">
                        <div class="flex-shrink-0">
                            ${med.lastTaken === new Date().toISOString().split('T')[0] ?
                                '<span data-lucide="circle-check" class="text-emerald-500 w-5 h-5"></span>' :
                                '<span data-lucide="circle-dashed" class="text-gray-400 w-5 h-5"></span>'
                            }
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">${med.name}</p>
                            <p class="text-sm text-gray-500">${med.dose} - ${med.frequency}</p>
                        </div>
                    </div>
                    <div class="mt-2 md:mt-0 flex flex-wrap gap-2 justify-end">
                        <span class="text-sm text-gray-500 self-center">Last taken: ${med.lastTaken}</span>
                        <button onclick="handleLogMedicationTaken(${med.id})" class="p-2 text-sm bg-emerald-500 text-white rounded-lg hover:bg-emerald-600">
                            Log Taken
                        </button>
                        <button onclick="handleEditMedicationForm(${med.id})" class="p-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            <span data-lucide="edit" class="w-4 h-4"></span>
                        </button>
                        <button onclick="handleRemoveMedication(${med.id})" class="p-2 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600">
                            <span data-lucide="trash-2" class="w-4 h-4"></span>
                        </button>
                    </div>
                </li>
            `).join('');
            if (lucide) {
                lucide.createIcons();
            }
        };
        
        const renderSymptomChart = () => {
            const chartData = patientData.symptomLog.map(log => ({
                date: log.date,
                severity: log.severity
            }));
        
            const container = document.getElementById('symptom-chart-container');
            const root = ReactDOM.createRoot(container);
            const { ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip } = window.Recharts;
        
            root.render(
                React.createElement(ResponsiveContainer, { width: '100%', height: 200 },
                    React.createElement(LineChart, { data: chartData },
                        React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: '#e5e7eb' }),
                        React.createElement(XAxis, { dataKey: 'date' }),
                        React.createElement(YAxis, { domain: [0, 5] }),
                        React.createElement(Tooltip, null),
                        React.createElement(Line, { type: 'monotone', dataKey: 'severity', stroke: '#8b5cf6', activeDot: { r: 8 } })
                    )
                )
            );
        };
        
        // --- Event Handlers & Setup ---

        const handleLogSymptomForm = () => {
            const form = document.getElementById('symptom-form');
            form.innerHTML = `
                <div>
                    <label class="block text-sm font-medium text-gray-700">Date</label>
                    <input type="date" name="date" value="${new Date().toISOString().split('T')[0]}" required class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Symptom</label>
                    <input type="text" name="symptom" required class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Severity (1-5)</label>
                    <input type="number" name="severity" min="1" max="5" value="1" required class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Notes</label>
                    <textarea name="notes" rows="3" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500"></textarea>
                </div>
                <button type="submit" class="w-full bg-emerald-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-emerald-700 transition-colors">
                    Log Symptom
                </button>
            `;
            form.onsubmit = (e) => {
                e.preventDefault();
                const newSymptom = {
                    date: form.date.value,
                    symptom: form.symptom.value,
                    severity: parseInt(form.severity.value),
                    notes: form.notes.value,
                };
                patientData.symptomLog.push(newSymptom);
                patientData.symptomLog.sort((a, b) => new Date(b.date) - new Date(a.date));
                renderSymptomLogTable();
                hideModal('symptom-modal');
                showNotification('New symptom logged successfully!');
            };
            showModal('symptom-modal');
        };

        const handleAddMedicationForm = (medication = null) => {
            const form = document.getElementById('medication-form');
            const title = document.getElementById('medication-modal-title');
            
            title.textContent = medication ? 'Edit Medication' : 'Add Medication';

            form.innerHTML = `
                <div>
                    <label class="block text-sm font-medium text-gray-700">Medication Name</label>
                    <input type="text" name="name" value="${medication ? medication.name : ''}" required class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Dose</label>
                    <input type="text" name="dose" value="${medication ? medication.dose : ''}" required class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Frequency</label>
                    <input type="text" name="frequency" value="${medication ? medication.frequency : ''}" required class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500" />
                </div>
                <button type="submit" class="w-full bg-violet-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-violet-700 transition-colors">
                    ${medication ? 'Save Changes' : 'Add Medication'}
                </button>
            `;

            form.onsubmit = (e) => {
                e.preventDefault();
                const newMed = {
                    name: form.name.value,
                    dose: form.dose.value,
                    frequency: form.frequency.value,
                };
                if (medication) {
                    const index = patientData.medication.findIndex(m => m.id === medication.id);
                    if (index !== -1) {
                        patientData.medication[index] = { ...newMed, id: medication.id, lastTaken: medication.lastTaken };
                        showNotification('Medication updated successfully!');
                    }
                } else {
                    const newId = patientData.medication.length > 0 ? Math.max(...patientData.medication.map(m => m.id)) + 1 : 1;
                    patientData.medication.push({ ...newMed, id: newId, lastTaken: 'N/A' });
                    showNotification('Medication added successfully!');
                }
                renderMedicationList();
                hideModal('medication-modal');
            };
            showModal('medication-modal');
        };

        const handleRemoveMedication = (medId) => {
            patientData.medication = patientData.medication.filter(med => med.id !== medId);
            renderMedicationList();
            showNotification('Medication removed!');
        };
        
        const handleLogMedicationTaken = (medId) => {
            const med = patientData.medication.find(m => m.id === medId);
            if (med) {
                med.lastTaken = new Date().toISOString().split('T')[0];
                renderMedicationList();
                showNotification('Medication logged as taken!');
            }
        };

        const setupPatientDashboardListeners = () => {
            document.getElementById('view-appointment-btn').addEventListener('click', () => {
                const modalContent = document.getElementById('appointment-modal-content');
                const appt = patientData.nextAppointmentDetails;
                modalContent.innerHTML = `
                    <p class="flex items-center space-x-2 text-gray-700">
                        <span data-lucide="stethoscope" class="w-5 h-5 text-violet-500"></span>
                        <span>Doctor: <span class="font-semibold">${appt.doctor}</span></span>
                    </p>
                    <p class="flex items-center space-x-2 text-gray-700">
                        <span data-lucide="calendar" class="w-5 h-5 text-violet-500"></span>
                        <span>Date: <span class="font-semibold">${new Date(patientData.nextAppointment).toLocaleDateString()}</span></span>
                    </p>
                    <p class="flex items-center space-x-2 text-gray-700">
                        <span data-lucide="bell" class="w-5 h-5 text-violet-500"></span>
                        <span>Time: <span class="font-semibold">${appt.time}</span></span>
                    </p>
                    <p class="flex items-center space-x-2 text-gray-700">
                        <span data-lucide="message-square" class="w-5 h-5 text-violet-500"></span>
                        <span>Address: <span class="font-semibold">${appt.address}</span></span>
                    </p>
                    <a href="${appt.mapLink}" target="_blank" rel="noopener noreferrer" class="w-full inline-flex items-center justify-center gap-2 bg-indigo-500 text-white py-2 px-4 rounded-xl font-semibold hover:bg-indigo-600 transition-colors">
                        <span data-lucide="clipboard" class="w-5 h-5"></span>
                        View on Map
                    </a>
                `;
                showModal('appointment-modal');
                if (lucide) {
                    lucide.createIcons();
                }
            });

            document.getElementById('log-symptom-btn').addEventListener('click', () => handleLogSymptomForm());
            document.getElementById('add-medication-btn').addEventListener('click', () => handleAddMedicationForm());
        };

        const setupNavigation = () => {
            const navButtons = {
                'nav-dashboard': 'patient-dashboard',
                'nav-resources': 'patient-resources',
                'nav-doctor': 'doctor-dashboard',
            };

            for (const [id, viewName] of Object.entries(navButtons)) {
                document.getElementById(id).addEventListener('click', () => {
                    // Update active state of buttons
                    for (const btnId in navButtons) {
                        const btn = document.getElementById(btnId);
                        if (btnId === id) {
                            btn.classList.add('text-violet-600', 'bg-violet-50');
                            btn.classList.remove('text-gray-500', 'hover:text-violet-600');
                        } else {
                            btn.classList.remove('text-violet-600', 'bg-violet-50');
                            btn.classList.add('text-gray-500', 'hover:text-violet-600');
                        }
                    }
                    currentView = viewName;
                    renderAppContent();
                });
            }
        };
        
        // Initial setup on window load
        window.onload = () => {
            setupNavigation();
            renderAppContent();
        };

    </script>
</body>
</html>

